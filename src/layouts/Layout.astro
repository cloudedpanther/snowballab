---
import '../styles/global.css';
import { toAbsoluteUrl, withBase } from '../utils/paths';

const { title = 'Snowballlab', description = '복리 계산기 기반 유틸 사이트', canonical } =
  Astro.props;
const base = import.meta.env.BASE_URL;
const site = import.meta.env.SITE ?? 'https://snowballlab.co.kr';
const canonicalPath = canonical ?? withBase(base, '/');
const canonicalHref = toAbsoluteUrl(canonicalPath, site);
---

<!doctype html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/png" sizes="192x192" href={withBase(base, '/favicon/android-chrome-192x192.png')} />
    <link rel="icon" type="image/png" href={withBase(base, '/favicon/favicon-32x32.png')} />
    <link rel="icon" type="image/png" href={withBase(base, '/favicon/favicon-16x16.png')} />
    <link rel="icon" href={withBase(base, '/favicon/favicon.ico')} />
    <link rel="apple-touch-icon" href={withBase(base, '/favicon/apple-touch-icon.png')} />
    <link rel="manifest" href={withBase(base, '/favicon/site.webmanifest')} />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content={description} />
    <link rel="canonical" href={canonicalHref} />
    <title>{title}</title>
    <meta property="og:site_name" content="Snowballlab" />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:type" content="website" />
    <meta property="og:url" content={canonicalHref} />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <script is:inline>
      const storageKey = 'theme';
      const className = 'dark';
      const root = document.documentElement;
      const applyTheme = (theme) => {
        if (theme === 'dark') {
          root.classList.add(className);
        } else {
          root.classList.remove(className);
        }
      };
      const stored = localStorage.getItem(storageKey);
      applyTheme(stored === 'dark' ? 'dark' : 'light');
      window.addEventListener('DOMContentLoaded', () => {
        const button = document.querySelector('[data-theme-toggle]');
        if (!button) return;
        const updateLabel = () => {
          const isDark = root.classList.contains(className);
          button.setAttribute('aria-pressed', String(isDark));
          button.textContent = isDark ? '다크' : '라이트';
        };
        updateLabel();
        button.addEventListener('click', () => {
          const isDark = root.classList.contains(className);
          const next = isDark ? 'light' : 'dark';
          localStorage.setItem(storageKey, next);
          applyTheme(next);
          updateLabel();
        });
      });
    </script>
  </head>
  <body class="min-h-screen bg-slate-50 text-slate-900 dark:bg-slate-950 dark:text-slate-100">
    <header class="border-b border-slate-200 bg-white/80 backdrop-blur dark:border-slate-800 dark:bg-slate-950/80">
      <div class="mx-auto flex w-full max-w-6xl items-center justify-between px-5 py-4">
        <a class="text-lg font-semibold tracking-tight" href={base}>
          Snowballlab
        </a>
        <nav class="flex items-center gap-4 text-sm text-slate-600 dark:text-slate-300">
          <a class="hover:text-slate-900 dark:hover:text-white" href={withBase(base, '/compound/lump/')}>
            거치식
          </a>
          <a class="hover:text-slate-900 dark:hover:text-white" href={withBase(base, '/compound/recurring/')}>
            적립식
          </a>
          <!-- TODO: 가이드 진입점은 Stage 6에서 공개 -->
          <!--
          <a class="hover:text-slate-900 dark:hover:text-white" href={withBase(base, '/guides/')}>
            가이드
          </a>
          -->
          <button
            type="button"
            data-theme-toggle
            class="cursor-pointer rounded-full border border-slate-200 px-3 py-1 text-xs text-slate-600 hover:border-slate-400 dark:border-slate-700 dark:text-slate-300 dark:hover:border-slate-500"
            aria-pressed="false"
          >
            라이트
          </button>
        </nav>
      </div>
    </header>

    <main class="mx-auto w-full max-w-6xl px-5 py-10">
      <slot />
    </main>

    <footer class="border-t border-slate-200 py-8 dark:border-slate-800">
      <div class="mx-auto flex w-full max-w-6xl flex-col gap-6 px-5 text-xs text-slate-500 dark:text-slate-400 md:flex-row md:items-start md:justify-between">
        <div class="space-y-2">
          <p>Snowballlab · 복리 계산기 기반 유틸 사이트</p>
          <p>투자 조언이 아니며 정보 제공 목적입니다.</p>
          <p>© {new Date().getFullYear()} Snowballlab. All rights reserved.</p>
        </div>
        <div class="flex flex-wrap items-center gap-3 md:justify-end">
          <a class="hover:text-slate-900 dark:hover:text-white" href={withBase(base, '/about/')}>
            About
          </a>
          <a class="hover:text-slate-900 dark:hover:text-white" href={withBase(base, '/contact/')}>
            Contact
          </a>
          <a class="hover:text-slate-900 dark:hover:text-white" href={withBase(base, '/privacy/')}>
            Privacy
          </a>
        </div>
      </div>
    </footer>
  </body>
</html>
